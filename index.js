(()=>{(function(){"use strict";var m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("k-draggable",{attrs:{element:"ul",list:e.items,options:{disabled:!e.sortable,handle:".relationship-item-sort",animation:150,forceFallback:!0},"data-sortable":e.sortable,"data-multiselectable":e.multiselectable,"data-deletable":e.deletable,"aria-readonly":"","aria-activedescendant":e.activedescendant,"aria-label":"",role:"listbox",tabindex:"0"},on:{change:e.onInput},nativeOn:{focus:function(s){return e.setupFocus.apply(null,arguments)},blur:function(s){return e.onBlur.apply(null,arguments)},keydown:[function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"space",32,s.key,[" ","Spacebar"])?null:(s.preventDefault(),e.onKeySpace.apply(null,arguments))},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"up",38,s.key,["Up","ArrowUp"])?null:(s.preventDefault(),e.onKeyUp.apply(null,arguments))},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"down",40,s.key,["Down","ArrowDown"])?null:(s.preventDefault(),e.onKeyDown.apply(null,arguments))},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"delete",[8,46],s.key,["Backspace","Delete","Del"])?null:(s.preventDefault(),e.removeItem(e.focused))}]}},e._l(e.items,function(s){return i("li",{staticClass:"relationship-item",class:{"is-focused":e.isFocused(s)},attrs:{id:e._uid+s.value,"aria-selected":e.isSelected(s),role:"option"},on:{mousedown:function(r){return e.focusItem(s)},click:function(r){return e.clickItem(s)}}},[e.sortable?i("k-icon",{staticClass:"relationship-item-sort",attrs:{type:"sort"}}):e._e(),i("span",{staticClass:"relationship-item-label"},[e._v(e._s(s.text))]),e.multiselectable?i("k-button",{attrs:{tabindex:"-1",icon:"add"}}):e._e(),e.deletable?i("k-button",{attrs:{tabindex:"-1",icon:"remove"},on:{click:function(r){return e.removeItem(s)}}}):e._e()],1)}),0)},_=[],B="";function a(e,t,i,s,r,h,d,D){var n=typeof e=="function"?e.options:e;t&&(n.render=t,n.staticRenderFns=i,n._compiled=!0),s&&(n.functional=!0),h&&(n._scopeId="data-v-"+h);var o;if(d?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(l=__VUE_SSR_CONTEXT__),r&&r.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(d)},n._ssrRegister=o):r&&(o=D?function(){r.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(n.functional){n._injectStyles=o;var F=n.render;n.render=function(O,p){return o.call(p),F(O,p)}}else{var f=n.beforeCreate;n.beforeCreate=f?[].concat(f,o):[o]}return{exports:e,options:n}}const v={inheritAttrs:!1,props:{items:Array,selected:{type:Array,default:function(){return[]}},sortable:Boolean,multiselectable:Boolean,deletable:Boolean},data(){return{focused:null,activedescendant:null}},methods:{clickItem(e){this.multiselectable&&this.toggleItem(e)},focusFirstItem(){var e=this.items[0];e&&this.focusItem(e)},focusItem(e){this.focused=e,this.activedescendant=this._uid+e.value,this.scrollIntoView(e)},focusLastItem(){var e=this.items[this.items.length-1];e&&this.focusItem(e)},focusNextItem(){if(!this.focused){this.focusFirstItem();return}var e=this.items[this.getIndex(this.focused)+1];e&&this.focusItem(e)},focusPrevItem(){if(!this.focused){this.focusFirstItem();return}var e=this.items[this.getIndex(this.focused)-1];e&&this.focusItem(e)},getIndex(e){return this.items.findIndex(t=>t.value===e.value)},isFocused(e){return e===this.focused},isSelected(e){for(var t=0;t<this.selected.length;t++)if(this.selected[t].value===e.value)return!0;return!1},moveDown(e){var t=this.getIndex(e);if(t<this.items.length-1){var i=this.items[t+1];this.items[t+1]=e,this.items[t]=i,this.onInput(this.items)}},moveUp(e){var t=this.getIndex(e);if(t>0){var i=this.items[t-1];this.items[t-1]=e,this.items[t]=i,this.onInput(this.items)}},onBlur(){this.sortable&&(this.selected=[])},onInput(e){this.$emit("input",e)},onKeyDown(){this.sortable&&this.focused&&this.isSelected(this.focused)?this.moveDown(this.focused):this.focusNextItem()},onKeySpace(){this.focused&&this.toggleItem(this.focused)},onKeyUp(){this.sortable&&this.focused&&this.isSelected(this.focused)?this.moveUp(this.focused):this.focusPrevItem()},removeItem(e){if(!this.deletable||!e)return!1;var t=this.items.indexOf(e);t!==-1&&this.items.splice(t,1),this.onInput(this.items)},scrollIntoView(e){},selectItem(e){this.selected.push(e),this.onInput(this.items)},setupFocus(){this.focused||this.focusFirstItem()},toggleItem(e){this.isSelected(e)?this.unselectItem(e):(this.multiselectable||(this.selected=[]),this.selectItem(e))},unselectItem(e){for(var t=0;t<this.selected.length;t++)if(this.selected[t].value===e.value){this.selected.splice(t,1),this.onInput(this.items);return}}}},u={};var b=a(v,m,_,!1,y,null,null,null);function y(e){for(let t in u)this[t]=u[t]}var I=function(){return b.exports}(),g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("k-field",e._b({staticClass:"kirby-relationship-field",attrs:{counter:e.counterOptions}},"k-field",e.$props,!1),[e.search?i("div",{staticClass:"relationship-search"},[i("k-input",{attrs:{theme:"field",type:"text",spellcheck:"false",icon:"search"},model:{value:e.query,callback:function(s){e.query=s},expression:"query"}})],1):e._e(),i("div",{staticClass:"relationship-lists"},[i("relationship-listbox",{staticClass:"relationship-list",attrs:{items:e.filteredOptions,selected:e.selected,multiselectable:!0,sortable:!1,deletable:!1},on:{input:e.onInput}}),i("relationship-listbox",{staticClass:"relationship-list",attrs:{items:e.selected,multiselectable:!1,sortable:!0,deletable:!0},on:{input:e.onInput}})],1)])},k=[],A="";const x={inheritAttrs:!1,components:{"relationship-listbox":I},props:{autofocus:Boolean,counter:{type:Boolean,default:!0},disabled:Boolean,help:String,id:{type:[Number,String],default(){return this._uid}},label:String,max:Number,min:Number,name:String,options:{type:Array,default(){return[]}},required:Boolean,search:Boolean,value:{type:Array,default(){return[]}},multiselectable:String},data(){return{selected:this.value,query:""}},computed:{counterOptions(){return this.value===null||this.disabled||this.counter===!1?!1:{count:this.value&&Array.isArray(this.value)?this.value.length:0,min:this.min,max:this.max}},filteredOptions(){return this.options.filter(e=>e.text.toLowerCase().includes(this.query.toLowerCase()))}},watch:{value(e){this.selected=e}},mounted(){},methods:{onInput(){this.$emit("input",this.selected)}},validations(){return{}}},c={};var C=a(x,g,k,!1,w,null,null,null);function w(e){for(let t in c)this[t]=c[t]}var S=function(){return C.exports}();panel.plugin("olach/relationship",{fields:{relationship:S}})})();})();
