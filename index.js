(()=>{(function(){"use strict";var m=function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("k-draggable",{attrs:{element:"ul",list:e.items,options:{disabled:!e.sortable,handle:".relationship-item-sort",animation:150,forceFallback:!0},"data-sortable":e.sortable,"data-multiselectable":e.multiselectable,"data-deletable":e.deletable,"aria-readonly":"","aria-activedescendant":e.activedescendant,"aria-label":"",role:"listbox",tabindex:"0"},on:{change:e.onInput},nativeOn:{focus:function(t){return e.setupFocus.apply(null,arguments)},blur:function(t){return e.onBlur.apply(null,arguments)},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"])?null:(t.preventDefault(),e.onKeySpace.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.preventDefault(),e.onKeyUp.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.preventDefault(),e.onKeyDown.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:(t.preventDefault(),e.removeItem(e.focused))}]}},e._l(e.items,function(t){return i("li",{staticClass:"relationship-item",class:{"is-focused":e.isFocused(t)},attrs:{id:e._uid+t.value,"aria-selected":e.isSelected(t),role:"option"},on:{mousedown:function(r){return e.focusItem(t)},click:function(r){return e.clickItem(t)}}},[e.sortable?i("k-icon",{staticClass:"relationship-item-sort",attrs:{type:"sort"}}):e._e(),i("span",{staticClass:"relationship-item-label"},[e._v(e._s(t.text))]),e.multiselectable?i("k-button",{attrs:{tabindex:"-1",icon:"add"}}):e._e(),e.deletable?i("k-button",{attrs:{tabindex:"-1",icon:"remove"},on:{click:function(r){return e.removeItem(t)}}}):e._e()],1)}),0)},_=[],B="";function a(e,s,i,t,r,d,f,D){var n=typeof e=="function"?e.options:e;s&&(n.render=s,n.staticRenderFns=i,n._compiled=!0),t&&(n.functional=!0),d&&(n._scopeId="data-v-"+d);var o;if(f?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(l=__VUE_SSR_CONTEXT__),r&&r.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(f)},n._ssrRegister=o):r&&(o=D?function(){r.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(n.functional){n._injectStyles=o;var F=n.render;n.render=function(O,p){return o.call(p),F(O,p)}}else{var h=n.beforeCreate;n.beforeCreate=h?[].concat(h,o):[o]}return{exports:e,options:n}}const v={inheritAttrs:!1,props:{items:Array,selected:{type:Array,default:function(){return[]}},sortable:Boolean,multiselectable:Boolean,deletable:Boolean},data(){return{focused:null,activedescendant:null}},methods:{clickItem(e){this.multiselectable&&this.toggleItem(e)},focusFirstItem(){var e=this.items[0];e&&this.focusItem(e)},focusItem(e){this.focused=e,this.activedescendant=this._uid+e.value,this.scrollIntoView(e)},focusLastItem(){var e=this.items[this.items.length-1];e&&this.focusItem(e)},focusNextItem(){if(!this.focused){this.focusFirstItem();return}var e=this.items[this.getIndex(this.focused)+1];e&&this.focusItem(e)},focusPrevItem(){if(!this.focused){this.focusFirstItem();return}var e=this.items[this.getIndex(this.focused)-1];e&&this.focusItem(e)},getIndex(e){return this.items.findIndex(s=>s.value===e.value)},isFocused(e){return e===this.focused},isSelected(e){return!!this.selected.find(i=>i.value===e.value)},moveDown(e){var s=this.getIndex(e);if(s<this.items.length-1){var i=this.items[s+1];this.items[s+1]=e,this.items[s]=i,this.onInput(this.items)}},moveUp(e){var s=this.getIndex(e);if(s>0){var i=this.items[s-1];this.items[s-1]=e,this.items[s]=i,this.onInput(this.items)}},onBlur(){this.sortable&&(this.selected=[])},onInput(e){this.$emit("input",e)},onKeyDown(){this.sortable&&this.focused&&this.isSelected(this.focused)?this.moveDown(this.focused):this.focusNextItem()},onKeySpace(){this.focused&&this.toggleItem(this.focused)},onKeyUp(){this.sortable&&this.focused&&this.isSelected(this.focused)?this.moveUp(this.focused):this.focusPrevItem()},removeItem(e){if(!this.deletable||!e)return!1;var s=this.items.indexOf(e);s!==-1&&this.items.splice(s,1),this.onInput(this.items)},scrollIntoView(e){},selectItem(e){this.selected.push(e),this.onInput(this.items)},setupFocus(){this.focused||this.focusFirstItem()},toggleItem(e){this.isSelected(e)?this.unselectItem(e):(this.multiselectable||(this.selected=[]),this.selectItem(e))},unselectItem(e){const s=this.selected.findIndex(i=>i.value===e.value);s!==-1&&(this.selected.splice(s,1),this.onInput(this.items))}}},u={};var b=a(v,m,_,!1,y,null,null,null);function y(e){for(let s in u)this[s]=u[s]}var I=function(){return b.exports}(),k=function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("k-field",e._b({staticClass:"kirby-relationship-field",attrs:{counter:e.counterOptions}},"k-field",e.$props,!1),[e.search?i("div",{staticClass:"relationship-search"},[i("k-input",{attrs:{theme:"field",type:"text",spellcheck:"false",icon:"search"},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1):e._e(),i("div",{staticClass:"relationship-lists"},[i("relationship-listbox",{staticClass:"relationship-list",attrs:{items:e.filteredOptions,selected:e.selected,multiselectable:!0,sortable:!1,deletable:!1},on:{input:e.onInput}}),i("relationship-listbox",{staticClass:"relationship-list",attrs:{items:e.selected,multiselectable:!1,sortable:!0,deletable:!0},on:{input:e.onInput}})],1)])},g=[],A="";const x={inheritAttrs:!1,components:{"relationship-listbox":I},props:{autofocus:Boolean,counter:{type:Boolean,default:!0},disabled:Boolean,help:String,id:{type:[Number,String],default(){return this._uid}},label:String,max:Number,min:Number,name:String,options:{type:Array,default(){return[]}},required:Boolean,search:Boolean,value:{type:Array,default(){return[]}},multiselectable:String},data(){return{selected:this.value,query:""}},computed:{counterOptions(){return this.value===null||this.disabled||this.counter===!1?!1:{count:this.value&&Array.isArray(this.value)?this.value.length:0,min:this.min,max:this.max}},filteredOptions(){return this.options.filter(e=>e.text.toLowerCase().includes(this.query.toLowerCase()))}},watch:{value(e){this.selected=e}},mounted(){},methods:{onInput(){this.$emit("input",this.selected)}},validations(){return{}}},c={};var C=a(x,k,g,!1,w,null,null,null);function w(e){for(let s in c)this[s]=c[s]}var S=function(){return C.exports}();panel.plugin("olach/relationship",{fields:{relationship:S}})})();})();
